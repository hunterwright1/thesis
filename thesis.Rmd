---
title: "University of Oregon Gym Attendance: An Analysis of Student Behavior and Decision Making"
author: "Hunter Wright"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE)

library(pacman)
p_load(tidyverse, forcats, kableExtra, stargazer, tseries, lmtest, sandwich, scales)

count <- read.csv("cleanData/count.csv")
members <- read.csv("cleanData/membership.csv")

```
```{r factor releveling, include=FALSE}
members <- members %>%
  mutate(day = fct_relevel(day, "Monday"))
count <- count %>%
  mutate(day = fct_relevel(day, "Monday")) %>%
  mutate(month = fct_relevel(month, "October")) %>%
  mutate(quarter = fct_relevel(quarter, "Fall"))

count$date <- as.Date(count$date)

count_open <- count %>%
  filter(closed == 0)
```

Notes:

- expand analysis/interpretation
- incorporate membership controls
- how to preview results?
- add formulas to represent behavioral economics concepts?
- formatting needs fix (last thing to do)


# Introduction

The University of Oregon’s Student Recreation Center (SRC) is the primary facility on campus for students to engage in physical activities like weightlifting, swimming, basketball, and other indoor sports. Students, faculty, staff, and community members alike enjoy more than 36,000 square feet of strength training space, a 12-lane swimming pool, and nearly two dozen courts and gymnasiums, among many other amenities. During normal hours, the SRC is open from 6am - 11pm on weekdays and 9am-9pm on weekends.

On any given day of the week, a student might have class, work, homework, and other responsibilities that take up most of their day. Coupled with basic tasks like eating and traveling, many students find their only free time on the weekends. For faculty and other community members, the same responsibilities are present, oftentimes with additional familial duties. According to the SRC website, “The Student Recreation Center is consistently busy Monday–Thursday during the term…Friday–Sunday, the Rec has much less traffic.” Most individuals have busy schedules during the week, and much more time on the weekend, so why does SRC traffic decrease when individuals have more time? In this thesis, I look to analyze short and long-term trends in SRC attendance to discuss how students, faculty, and other SRC patrons display behaviors consistent with the behavioral economics concepts of present bias and loss aversion.

```{r Attendance Plot, fig.height=3, fig.width=5, fig.align = 'center'}
.plot2024 <- count %>%
  mutate(year = year(date)) %>%
  filter(year == 2024) %>%
  mutate(week = floor_date(date, "week", week_start = 1)) %>%
  group_by(week) %>% 
  summarise(avg_total = mean(total, na.rm = TRUE), .groups = "drop") %>% 
  ggplot(aes(week, avg_total)) +
  geom_line() +
    labs(x = NULL,
         y = "Average Daily Visits",
         title = "Weekly Average Gym Attendance – 2024") +
  theme_bw() +
  theme(
    plot.title = element_text(size = 10, face = "bold"),
    plot.subtitle = element_text(size = 7),
    axis.title = element_text(size = 10),
    axis.text = element_text(size = 7)
  )

.plot2024
```

### Literature Review

The primary literature relating to this thesis is Prospect Theory: An Analysis of Decision Under Risk, by Kahneman and Tversky (1979). This paper serves as a critique of expected utility theory by providing evidence that humans do not act completely rationally when presented with decisions that involve risk. For example, when presented with the following two choices:

- Choice A: 50% chance to receive $1,000, 50% chance to receive nothing

- Choice B: 100% chance to receive $450

The expected monetary values are:

$$\mathbb{E}[A] \;=\; 0.5 \times 1000 + 0.5 \times 0 \;=\; \$500$$

$$\mathbb{E}[B] \;=\; 1.0 \times 450 \;=\; \$450$$

Kahneman and Tversky found that most participants selected choice B, even though $\mathbb{E}[A] > \mathbb{E}[B]$, illustrating a systematic departure from the standard economic assumption of utility maximization under risk. While Kahneman and Tversky were focused mainly on monetary decisions under risk, I focus on time as another form of currency, where students risk their academic success based on their use of time. Other similar literature related to gym attendance focuses mainly on incentives. Incentives are another behavioral economic concept originating from Nudge Theory in a book Nudge: Improving Decisions About Health, Wealth, and Happiness by Thaler and Sunstein (2008). For example, Habla and Muller found increases in weekly exercise frequency from members that received weekly email reminders.

# Background

Behavioral economics is the study of how people in the real world approach decisions in an irrational manner. Contrary to what standard model economics believes, people don't disregard emotion, habit, and other feelings when making decisions. Though behavioral economics primarily focuses on how individuals make decisions with limited money, this thesis shows that individuals may treat limited time in a similar manner.  

### The Standard Economic Model

The standard economic model predicts that all individuals are rational agents that maximize their utility subject to a constraint. In this case, the agent's constraint is the number of hours in a day. With so few hours of free time in a weekday, we would not expect a rational agent to prioritize going to the gym. In other words, if this model reflected reality, we would observe a decrease in gym attendance during the week where the opportunity cost of an hour is higher, and increase in gym attendance on the weekend where the opportunity cost of an hour is cheaper. However, as the graph below shows, this tends not to be the case.

```{r week 3 attendance plot, fig.height=3, fig.width=5, fig.align = 'center'}
count %>%
  mutate(year = year(date)) %>%
  filter(year == 2024) %>%
  filter(month == "October") %>%
  filter(week == 3) %>%
  ggplot(aes(x = date, y = total)) + 
  geom_line() +
  geom_point(size = 2) +
  scale_y_continuous(labels = comma_format()) +
  scale_x_date(date_breaks = "1 day",
               date_labels = "%A") +
  labs(
    x = NULL,
    y = "Attendance",
    title = "Week 3 Gym Attendance, Fall 2024",
    subtitle = "October 14 – 20, 2024"
  ) +
  theme_bw() +
  theme(
    plot.title = element_text(size = 10, face = "bold"),
    plot.subtitle = element_text(size = 7),
    axis.title = element_text(size = 10),
    axis.text = element_text(size = 7)
  )

```

### Present Bias
 
Individuals experiencing a dilemma with ramifications that unfold over time (known as intertemporal choice) may engage in temporal discounting, where they place less value on choices with future rewards, even if they are greater than present rewards. This is known as **present bias**. For example, someone may choose to use their disposable income to consume goods (like buying a car), instead of putting it in a savings account. In this thesis, I aim to interpret present bias in how individuals utilize their time. For many people, going to the gym is hard and its payoffs take time. If someone only has two days a week to relax, they might skip the gym on the weekend and spend their time relaxing, because the immediate gratification of relaxing is worth more to them than the future benefit of a consistent gym routine. 

### Loss Aversion (in progress)

Loss aversion stems from an agent's perceived utility from loss and gains relative to a reference point.

Weekend reference point: relaxation. 
utility from exercise is not enough to deviate from relaxation => lower attendance

Weekday reference point: hard work
no utility loss from exercise during the week as reference point is hard work => high attendance

# Data

Almost every person that enters the SRC must scan their ID through one of the turnstiles. These machines then record the time and date of every person who walks through. Table 1 shows the summary statistics for daily entries between January 2015 and December 2024 for days where the SRC is open. This accounts for about 81% of the days in the data, which includes a period between March 18th, 2020 and September 17th, 2020 where the SRC closed due to COVID-19. Students make up about 93% of daily gym attendees on average. 

- talk about discrepancy between two data sets
- talk about possible data collection issues.

```{r student proportion calculation, include=FALSE}
members %>%
  summarize(
    meanStudents = mean(students),
    meanTotal = mean(total),
    averageproportion = meanStudents/meanTotal
  )
```

```{r summary statistics}

# closed days are removed
.summary_stats <- count_open %>%
  summarise(
    Mean = mean(total),
    Median = median(total),
    SD = sd(total),
    Min = min(total),
    Max = max(total)
  )

kable(.summary_stats, caption = "Summary Statistics") %>%
  kable_styling(full_width = FALSE) %>%
  row_spec(0, align = "c") %>%
  row_spec(1, align = "c")
```

# Methods

For my analysis, I maintain my use of the recorded daily entrances between January 2015 and December 2024, without

To analyze both short and long‑run attendance dynamics, I regress daily gym patron attendance on lagged attendance, weekday, week‑of‑term, month, quarter, post‑closure status, and finals/dead‑week indicators. 

$$
\hat{\text{total}}_{t} = \beta_0 + \beta_1\,\text{total}_{t-1} \;+\; \sum_{d=1}^{6}\gamma_d\,\text{Day}_{d,t} \;+\;\beta_2\,\text{Week}_t \;+\;
\sum_{m=2}^{12}\delta_m\,\text{Month}_{m,t} \;+\; \sum_{q=2}^{4}\theta_q\,\text{Quarter}_{q,t}\;+\; \beta_3\,\text{AfterClosed}_t
$$ 
$$
\;+\; \beta_4\,\text{FinalsWeek}_t \;+\; \beta_5\,\text{DeadWeek}_t \;+\; \varepsilon_t
$$

Because I'm working with time series data, I conducted several tests to ensure unbiased estimates and satisfy Gauss-Markov assumptions. The daily attendance counts displayed both conditional heteroskedasticity (Breusch-Pagan $\chi^2$ = 889.97, p<0.01) and positive serial correlation (Durbin-Watson = 1.69, p<0.01). To maintain sound standard error measures, I report Newey–West heteroskedasticity and autocorrelation‑consistent (HAC) standard errors with a seven day bandwidth. Additionally, an autocorrelation function (ACF) test revealed strong AR(1) persistence, necessitating the addition of a lagged dependent variable.

# Results
```{r first regression, include=FALSE}

model <- lm(total ~ lag(total) + day + week + month + quarter + day_after_closed + finals_week + dead_week, count_open)

#adding a lag reduced AR(1)
summary(model)

robust <- sqrt(diag(NeweyWest(model, lag = 7)))

```

```{r day regression stargazer, results = "asis"}
.s1Variables <- c("Constant", "lag\\(total\\)", "dayTuesday", "dayWednesday", "dayThursday", "dayFriday",  "daySaturday",  "daySunday")

stargazer(model,
          type = "latex",
          keep = .s1Variables,
          order = .s1Variables,
          se = list(robust),
          keep.stat = c("n", "adj.rsq", "ser", "f"),
          digits = 3,
          dep.var.labels = "Total Attendance",
          covariate.labels = c("Intercept", "Total Students (t-1)", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"),
          title = "Intraweek Effects",
          header = FALSE,
          no.space = TRUE)
```

Controlling for AR(1) persistence, the model predicts a statistically significant monotonic decline as the week progresses. The intercept, representing a Monday in fall term, not during finals/dead week, and not after a closure, expects 2,779 students on average, that declines to an intraweek low on Saturday. The lagged attendance variable predicts that 75% of Monday's "surprise", if any, carries on to the next day. For example, if there are 1,000 more patrons on Monday, we expect ~750 more than expected on Tuesday. These outcomes reinforce the idea that gym patrons are not acting as rational agents when deciding how to spend their time. With a consistently decreasing attendance as the week progresses, gym attendees are going when their time is the most valuable (the beginning of the week), and going less as their time becomes less valuable. 


```{r quarter regression stargazer, results = "asis"}
.s2Variables <- c("Constant", "week", "dead_week", "finals_week", "quarterBreak", "quarterWinter", "quarterSpring", "quarterSummer")

stargazer(model,
          type = "latex",
          keep = .s2Variables,
          order = .s2Variables,
          se = list(robust),
          keep.stat = c("n", "adj.rsq", "ser", "f"),
          digits = 3,
          dep.var.labels = "Total Attendance",
          covariate.labels = c("Intercept", "Week of the Term", "Finals Week", "Week Before Finals", "Break", "Winter", "Spring", "Summer"),
          title = "Long Term Effects",
          header = FALSE,
          no.space = TRUE)
```

Longer term effects showed more inconsistent significance. The week of the term coefficient reports a significant but negligible negative relationship with attendance, while the finals week variable predictably reports lower attendance. 




The F-statistic reports a statistically significant value of 780, rejecting the null hypothesis that all coefficients are zero.  Coupled with an adjusted $R^2$ of 0.872, this model accounts for a substantial share of day to day variation in gym attendance.

# Conclusion




