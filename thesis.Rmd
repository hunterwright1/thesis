---
title: "thesis"
author: "Hunter Wright"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(pacman)
p_load(tidyverse)
```

Topics to cover:
- loss aversion
- herd behavior
- rank members by how valuable their time is

Questions: 

For many people, going to the gym is hard, and more importantly, it takes time. Is there a significant effect of certain events like finals on gym attendance? 

What trends in attendance do we observe across different time periods? 

How do different membership types behave differently in response to certain conditions?



Dummy variables to add:
week of the quarter fixed effects
quarter fixed effects
calendar month (possible)

weather (rainy or not) *

consider dropping closed days

summary stats table
might need only one regression for the entire paper?

intro, background, info about data, methods, results, brief conclusion 
add graph representing year 2024 data

```{r read csv}

count <- read.csv("cleanData/count.csv")
members <- read.csv("cleanData/membership.csv")

```
```{r rename count columns}

count <- count %>%
  rename(am5 = "X5.00AM", am6 = "X6.00AM", am7 = "X7.00AM", am8 = "X8.00AM", am9 = "X9.00AM", am10 = "X10.00AM", am11 = "X11.00AM", pm12 = "X12.00PM", pm1 = "X1.00PM", pm2 = "X2.00PM", pm3 = "X3.00PM", pm4 = "X4.00PM", pm5 = "X5.00PM", pm6 = "X6.00PM", pm7 = "X7.00PM", pm8 = "X8.00PM", pm9 = "X9.00PM", pm10 = "X10.00PM", pm11 = "X11.00PM")
```
```{r weekday column + weekend, covid, closure dummies}

# create weekday column
members <- members %>%
  mutate(day = weekdays(as.Date(date))) %>%
  relocate( day, .after = date) 
count <- count %>%
  rename(date = Date) %>%
  mutate(day = weekdays(as.Date(date))) %>%
  relocate( day, .after = date)

# weekday/weekend dummy
members <- members %>%
  mutate(weekend = ifelse(day == "Saturday" | day == "Sunday", 1, 0))
count <- count %>%
  mutate(weekend = ifelse(day == "Saturday" | day == "Sunday", 1, 0))

# covid dummy
members <- members %>%
  mutate(covid = ifelse("2020-03-18" <= date & date < "2020-09-21", 1, 0))
count <- count %>%
  mutate(covid = ifelse("2020-03-18" <= date & date < "2020-09-21", 1, 0))

#closed dummy (total entrances = 0)
members <- members %>%
  mutate(closed = ifelse(students == 0, 1, 0)) #no students: probably closed
count <- count %>%
  mutate(closed = ifelse(total < 10, 1, 0)) # account for closures with pe_staff present

#day after closed dummy
members <- members %>%
  mutate(day_after_closed = ifelse(lag(closed) == 1, 1, 0))
members[1, "day_after_closed"] <- 0

count <- count %>%
  mutate(day_after_closed = ifelse(lag(closed) == 1, 1, 0))
count[1, "day_after_closed"] <- 0

#closure numbers within 20 observations of each other
members %>%
  filter(students == 0) %>%
  nrow() #655

count %>%
  filter(total < 10) %>%
  nrow() #672
```
```{r finals dummy}
.finals <- tribble( #create df of finals week dates
  ~year,   ~start,       ~end,
  2015, "2015-12-07", "2015-12-11",
  2016, "2016-12-05", "2016-12-09",
  2017, "2017-12-04", "2017-12-08",
  2018, "2018-12-03", "2018-12-07",
  2019, "2019-12-09", "2019-12-13",
  2020, "2020-12-07", "2020-12-11",
  2021, "2021-12-06", "2021-12-10",
  2022, "2022-12-05", "2022-12-09",
  2023, "2023-12-04", "2023-12-08",
  2024, "2024-12-09", "2024-12-13",
  2015, "2015-03-16", "2015-03-20",
  2016, "2016-03-14", "2016-03-18",
  2017, "2017-03-20", "2017-03-24",
  2018, "2018-03-19", "2018-03-23",
  2019, "2019-03-18", "2019-03-22",
  2020, "2020-03-16", "2020-03-20",
  2021, "2021-03-15", "2021-03-19",
  2022, "2022-03-14", "2022-03-18",
  2023, "2023-03-20", "2023-03-24",
  2024, "2024-03-18", "2024-03-22",
  2015, "2015-06-08", "2015-06-12",
  2016, "2016-06-06", "2016-06-10",
  2017, "2017-06-12", "2017-06-16",
  2018, "2018-06-11", "2018-06-15",
  2019, "2019-06-10", "2019-06-14",
  2020, "2020-06-08", "2020-06-12",
  2021, "2021-06-07", "2021-06-11",
  2022, "2022-06-06", "2022-06-10",
  2023, "2023-06-12", "2023-06-16",
  2024, "2024-06-10", "2024-06-14"
) %>%
  mutate(across(start:end, as.Date)) #convert to date objects

.deadweek <- .finals %>% #create dead week df
  mutate(
    start = start - 7, #monday before finals
    end   = end   - 5) #sunday before finals

.finalsDead <- bind_rows( #combine into one df
  .finals %>% mutate(finals_week = 1, dead_week = 0), #finals 1, deadweek 0
  .deadweek %>% mutate(finals_week = 0, dead_week = 1) #finals 0, deadweek 1
)

members <- members %>% #add to main data
  mutate(date = as.Date(date)) %>%
  left_join(.finalsDead,
            join_by(between(date, start, end))) %>%
  mutate(
    finals_week = coalesce(finals_week, 0L),
    dead_week   = coalesce(dead_week,   0L)
  ) %>%
  select(-year, -start, -end) #remove unneeded cols

count <- count %>% #repeat for other data
  mutate(date = as.Date(date)) %>%
  left_join(.finalsDead,
            join_by(between(date, start, end))) %>%
  mutate(
    finals_week = coalesce(finals_week, 0L),
    dead_week   = coalesce(dead_week,   0L)
  ) %>%
  select(-year, -start, -end)

count <- count %>%
  select(-am5) #remove 5am col (rec normally closed at this hour)

```
```{r gameday dummy}
.gameday <- c(2015-05-02, 2015-09-05, 2015-09-19, 2015-09-26, 2015-10-10, 2015-11-07,   2015-11-21, 2015-11-27, 2016-04-30, 2016-09-03, 2016-09-10, 2016-09-24, 2016-10-08, 2016-10-29, 2016-11-12, 2017-04-29, 2017-09-02, 2017-09-09, 2017-09-30, 2017-10-07, 2017-10-28, 2017-11-18, 2017-11-25, 2018-04-21, 2018-09-01, 2018-09-08, 2018-09-15, 2018-09-22, 2018-10-13, 2018-11-03, 2018-11-17, 2019-04-20, 2019-09-07, 2019-09-14, 2019-10-05, 2019-10-11, 2019-10-26, 2019-11-16, 2019-11-30, 2020-04-18, 2020-11-07, 2020-11-21, 2021-05-01, 2021-09-04, 2021-09-18, 2021-09-25, 2021-10-15, 2021-10-30,   2021-11-13, 2021-11-27, 2022-04-23, 2022-09-10, 2022-09-17, 2022-10-01,2022-10-22, 2022-11-12, 2022-11-19, 2023-04-29, 2023-09-02, 2023-09-16,   2023-09-23, 2023-10-21, 2023-11-04, 2023-11-11, 2023-11-24, 2024-04-27,   2024-08-31, 2024-09-07, 2024-10-04, 2024-10-12, 2024-10-26, 2024-11-09, 2024-11-300)

members <- members %>% 
  mutate(gameday = as.integer(date %in% .gameday))
count <- count %>% 
  mutate(gameday = as.integer(date %in% .gameday))

```












